<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Products â€” PrimeSoft</title>
  <meta name="description" content="Browse PrimeSoft subscription products and add to cart for WhatsApp checkout." />
  <link rel="stylesheet" href="styles.css" />
  <style>
    .productCard { display:flex; flex-direction:column; gap:12px; }
    .productTop { display:flex; align-items:flex-start; justify-content:space-between; gap:12px; }
    .logoBox{
      width:56px;height:56px;border-radius:18px;
      display:flex;align-items:center;justify-content:center;
      font-weight:1000;border:1px solid var(--line);
      background: linear-gradient(135deg, rgba(30,64,175,.22), rgba(14,165,233,.14));
      flex:0 0 auto;
      font-size:16px;
    }
    .priceLine { font-size:22px; font-weight:1000; letter-spacing:-0.02em; }
    .muted { color: var(--muted); font-weight:700; }
    .actions { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .qty { width: 90px; }
    .mini { font-size:12px; color: var(--muted); margin-top:2px; }
  </style>
</head>
<body>

<header class="nav">
  <div class="container nav-inner">
    <a class="brand" href="index.html"><span class="logo"></span><span>PrimeSoft</span></a>
    <nav class="nav-links">
      <a href="products.html">Products</a>
      <a href="how-it-works.html">How it Works</a>
      <a href="faq.html">FAQ</a>
      <a class="btn ghost" href="contact.html">Support</a>
      <a class="btn" href="cart.html">Cart (<span data-cart-count>0</span>)</a>
      <button class="btn" onclick="toggleTheme()" type="button" aria-label="Toggle theme">ðŸŒ“</button>
    </nav>
  </div>
</header>

<main class="container">
  <section class="section">
    <div class="kicker">Products</div>
    <h1 class="h1">Browse subscriptions</h1>
    <p class="p-lg">Choose a product, select quantity, and add to cart. Checkout happens via WhatsApp.</p>

    <div class="notice" style="margin-top:14px">
      âœ… Tip: After adding items, open <strong>Cart</strong> to checkout.
    </div>

    <div id="productGrid" class="grid" style="grid-template-columns:repeat(3,1fr);margin-top:18px"></div>

    <div class="section" style="padding-top:18px">
      <div class="card">
        <h2 class="h2">Need help choosing?</h2>
        <p class="p">Contact support and include the product name + your activation email.</p>
        <div class="section-sm row" style="justify-content:flex-start">
          <a class="btn primary" href="contact.html">Contact Support</a>
          <a class="btn" href="faq.html">Read FAQ</a>
        </div>
      </div>
    </div>
  </section>
</main>

<footer class="footer">
  <div class="container grid footer-grid">
    <div>
      <div class="row" style="justify-content:flex-start;gap:10px"><span class="logo"></span><strong>PrimeSoft</strong></div>
      <p class="help" style="margin-top:10px">Â© <span id="y"></span> PrimeSoft.</p>
    </div>
    <div class="grid" style="grid-template-columns:repeat(2,1fr);gap:12px">
      <div class="grid">
        <a href="products.html">Products</a>
        <a href="how-it-works.html">How it Works</a>
        <a href="faq.html">FAQ</a>
      </div>
      <div class="grid">
        <a href="contact.html">Support</a>
        <a href="cart.html">Cart</a>
        <a href="index.html">Home</a>
      </div>
    </div>
  </div>
</footer>

<script src="app.js"></script>
<script>
  document.getElementById("y").textContent = new Date().getFullYear();

  const grid = document.getElementById("productGrid");

  function safeText(v){ return String(v ?? ""); }

  function renderProducts() {
    const products = (window.getAllProducts ? window.getAllProducts() : []) || [];
    if (!products.length) {
      grid.innerHTML = `
        <div class="card" style="grid-column:1/-1">
          <h2 class="h2">No products found</h2>
          <p class="p">Check your <code>PRODUCTS</code> array in <code>app.js</code>.</p>
        </div>
      `;
      return;
    }

    grid.innerHTML = products.map(p => {
      const price = window.formatLKR ? window.formatLKR(p.priceLkr) : p.priceLkr;
      return `
        <div class="card productCard hover">
          <div class="productTop">
            <div style="display:flex; gap:12px; align-items:flex-start">
              <div class="logoBox">${safeText(p.logoText)}</div>
              <div>
                <div class="row" style="justify-content:flex-start;gap:10px;flex-wrap:wrap">
                  <strong style="font-size:16px">${safeText(p.name)}</strong>
                </div>
                <div class="muted">${safeText(p.tagline)}</div>
                <div class="mini">Delivered/activated after confirmation.</div>
              </div>
            </div>
          </div>

          <div class="row" style="align-items:flex-end">
            <div>
              <div class="small">Price</div>
              <div class="priceLine">${price}<span class="small"> / month</span></div>
            </div>
          </div>

          <div class="actions">
            <input id="qty-${safeText(p.id)}" class="input qty" type="number" min="1" value="1" />
            <button class="btn primary" type="button" onclick="addItem('${safeText(p.id)}')">Add to cart</button>
            <a class="btn" href="cart.html">View cart</a>
          </div>
        </div>
      `;
    }).join("");

    // Responsive fallback if your CSS doesn't handle it
    const mq = window.matchMedia("(max-width: 900px)");
    function setCols() {
      grid.style.gridTemplateColumns = mq.matches ? "1fr" : "repeat(3,1fr)";
    }
    mq.addEventListener?.("change", setCols);
    setCols();
  }

  function addItem(productId) {
    const qtyEl = document.getElementById("qty-" + productId);
    const qty = Math.max(1, Number(qtyEl?.value || 1));
    if (window.cart?.addToCart) {
      window.cart.addToCart(productId, qty);
      alert("Added to cart âœ…");
    } else {
      alert("Cart system not found. Make sure app.js is loaded.");
    }
  }

  renderProducts();
</script>
</body>
</html>
